Project-specific notes:
=======================

File and path naming 'convention' of the source file directory:
Path: Project/Donor/(third_path_token)/Experiment_type/(tracks|peak_call)/
File: (Donor)_(third_path_token)_(Experiment_type)_(Repetition)_(peaks){0,1}.(forward|reverse|narrowPeak|broadPeak|coverage|methylation).(bb|bw)
Note: mEGAdata.experiment_type corresponds to IHEC.assay

(third_path_token) takes on a few forms, depending on the project.  Often it is sample.tissue_type or a cell_type.  Doesn't appear to be relevant to 2016 McGill IHEC DH but could have implications for matching mEGAdata.public_track to mEGAdata.experiment_type.

# TODO: Currently, all files are inserted in to DB as hg38 public_tracks.  Probably shouldn't be inserting the non-humna primate tracks at all.  Mouse tracks should be mm10 assembly.


General thoughts
----------------
What are these called: (forward|reverse|narrowPeak|broadPeak|coverage|methylation).  track_type is not a very good name (since it often means assay), but seems to be used here in public_track.track_type.

There are some repeats in here, designated by file_name containing `Rep_1` (or 2, or 3).  Something will have to be done (mark one as primary, or do we want repeats?)  This is often identified in either the public_track.raw_experiment_type or sometimes the (third_path_token) field.

List unlinked datasets that ought to have public_track matches.  A direct MySQL operation.  Requires completeness.  Maybe do it in SQL at the end.


Operation
---------
Setup:
Configure MySQL for no-password access.
Activate scripts/scripts-venv.

Config:
Generally, work one EMC project at a time.
cd scripts/
Uncomment the project in link_public_tracks_to_datasets.py main()
Specify project name in run_and_log.sh
Specify the project wildcard in findOrphanedDatasets.sql and findUnlinkedPublicTracks.sql

Running:
./run_and_log.sh

Diagnosis:
Examine the /logs/


EMC_Asthma
----------
(third_path_token): Unknown meaning.  _10x and _0.5x sometimes gets parsed away from Experiment_type, though it shouldn't be a problem. #TODO verify this.


EMC_BluePrint
-------------
(third_path_token): Values take the following forms: GR, H3_nTC, Mono or nTC.  nTC (no Template Control?)  So far, this is ignored.

Repeats present.  For instance:
EMC_BluePrint/S000X1/nTC/ChIP_2_H3K4me1/peak_call/S000X1_nTC_ChIP_2_H3K4me1_1_peaks.broadPeak.bb

./EMC_BluePrint/nTC/nTC/ChIP_Input/tracks/nTC_ChIP_Input.bw seems incorrectly named (nTC twice)


EMC_Bone
--------
(third_path_token): Cort_Bone or Trab_Bone.  Probably a tissue type.  Ignored.

Some of the unmapped NChIP experiment_types are here.

According to mEGAdata UI, there are donors and samples, but no datasets.  #TODO Some will probably have to be defined.


EMC_BrainBank
--------------
(third_path_token): Special.  Careful.

Some not automatically linked datasets are because there are sample names AND experiment_types in the (third_path_token).  Intervene manually for these cases.

Uh-oh.  There is some kind of 'pooling' going on here.  Not sure what it is, or whether it has implicatons for repetitions.  Most of the mEGAdata metadata (only 15 datasets exist) are matched to 'pools'.  The variable number of _'s in the sample.private_name are because these pools have different numbers of constituents.

Question: What to do with the non-pooled (single sample) analysed data?  Does it get released?  There does not appear to be any metadata exclusive to them (only have meatadata from pools).

There are data files for BA11_Brain_RNASeq (part of S133_BA11_Brain pool?). There are files for BA11_BS, but no metadata.

BA8_BA9 BS versus BA8_BA9_Brain RNASeq?

See logs/EMC_BrainBankLog_noMatch.txt for annotated details.

# Do a quick check that the linked datasets are indeed properly linked.  Done.  Yes.

(scripts-venv) assez@heap:~/projects/megadata/scripts$ grep -c "None or multiple corresponding" brainLog.txt 
106 - *** Check if these no corresponding dataset found are appropriate.***
(scripts-venv) assez@heap:~/projects/megadata/scripts$ grep -c "mapping to all of:" brainLog.txt
0
(scripts-venv) assez@heap:~/projects/megadata/scripts$ grep -c "Dataset linked" brainLog.txt
170 - Spotcheck a few.  They look good.
(scripts-venv) assez@heap:~/projects/megadata/scripts$ grep -c "No mapping experiment_type.name for" brainLog.txt 
12 - All are unmapped NChiPs. (There are more unmapped NCHiPs in other projects too.)

Any manual pairings required?  Yes.  #TODO: And ask about the ChIP2.

Validation scripts:
1) findUnlinkedPublicTracks.sql
104 results.

2) findOrphanDatasets.sql
Going through donor_metadata.value = 'EMC_Brain%'
14 datasets orphaned. (That's a fair amount, almost 1/9th of this project.  Most of the orphans are RNA-Seq.)


EMC_Cagekid
-----------
(third_path_token): Kidney types, Normal or Tumour tissue.

Every kidney has a 'normal' sample (named N1 or N2) or a tumour (T1) sample.  This info should be present in the `additional_information` and `disease` columns of mEGAdata (though it didn't transfer to the .ods version, for some reason.)

#TODO: Should both be included in the IHEC submission?  Probably yes.

We've got both BS and BS2 tracks.  What is the diff, which should be used?


EMC_COPD
--------
What is this?  Only one Donor/Sample


EMC_Drouin
----------
fastq.gz files only.  Should ask about this project.  Only two samples, but they've got 16 datasets.


EMC_iPSC
--------
(third_path_token): Always 'iPS'.  Ignored.

Has three human donors (others are other primates).


EMC_Leukemia
------------
(third_path_token): Always 'PreBC' or 'PreBC'.  Ignored.


EMC_Mature_Adipocytes
---------------------
Donors EG011 -> EG020: No entry in the DB.  These are all ATACSeq (non-core IHEC assay, so maybe best to ignore them).  These missing donor represent about 3/8 of the EMC_Mature_Adiposytes tracks. ATACSeq is an IHEC non-core assay.

Also, EG010 is ATACSeq, but IS present in the DB.  Manually joined.

Using hook that sample.private_name is within public_track.file_name (INsufficiently distinct).

(third_path_token): Appears to be cell types.  Ignored.

'EG006' has a typo: 'SC_Stoma'


EMC_Mitochondrial_Disease
-------------------------
(third_path_token): Always Muscle.  Ignored.


EMC_MSCs
--------
(third_path_token): A mess.  One parsing error effecting raw_experiment_type - manually moved:
EMC_MSCs/454T/MSC_Tagmentation-ChIP_100K/H3K4ME1/peak_call/454T_MSC_Tagmentation-ChIP_100K_H3K4ME1_2_peaks.broadPeak.bb

Will have to examine this project closely.


EMC_Primate
-----------
fastq.gz files only.
Are any of these human primates?  Unknown.


EMC_Rodent_Brain
----------------
fastq.gz files only.
IHEC does take mice data, after all...
No records of mice donors in DB.


EMC_SARDs
---------
(third_path_token): TC or Mono.  Not important (see below).
EMC_SARDs/012/Mono/NChIP_H3K27me3/peak_call/012_Mono_NChIP_H3K27me3_1_peaks.broadPeak.bb

TC = T Cell
BC = B Cell
Mono = Monocyte 
Ce sont toutes des cellules du syst√®me immunitaire.

Lots of fastq.gz that don't have corresponding .bb or .bw.  (Possibly in other projects too.  Only looked here.)


EMC_Temporal_Change
-------------------
If these are "changes over time", should all datasets be included?

(third_path_token): TC, or Mono.  (Same as EMC_SARDs.)

# Also, path & filename seem to have conflicting indicators (H3K9me3 or Input - which is it?)
# EMC_Temporal_Change/BCU1799/TC/H3K9me3/tracks/BCU1799_TC_ChIP_Input_1.bw
